<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Calculating Risk</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Calculating Risk</h1>



<p>Decisions can be defined via stated policy objectives. In our example
the policy objective is to ensure that the number of individuals
requiring hospitalization remains below the available hospital capacity.
The stated policy objective establishes the criteria for differentiating
between policy successes and failures. For example, exceeding hospital
capacity is more undesirable than not exceeding it. Therefore, the
stated policy objective acts as a threshold against which risks can be
evaluated. Risk can be measured in terms of the probability of an
undesirable outcome occurring (i.e., exceeding the policy objective),
the magnitude of deviations from the stated policy objective, and the
duration of these deviations.</p>
<div id="risk-form" class="section level2">
<h2>Formula</h2>
<p>The expected risk for each policy alternative can be estimated using
the outputs from multiple model runs with different input parameter
sets, as outlined in the box below. Additionally, a weighted version of
this formula, which accounts for simulation runs with different weights,
is provided.</p>
<p>The expected risk is calculated over a pre-defined time range (<span class="math inline">\(t = t_{\rm min}…t_{\rm max}\)</span>), which
should be selected to capture important features of the decision
problem, such as the maximum duration for which any of the policy
options being considered might be adopted. The decision threshold (<span class="math inline">\(D_{\rm t}\)</span>) can be either a maximum, such
as a maximum hospital capacity, or a minimum, such as a target number of
vaccinations to be delivered. The decision threshold (<span class="math inline">\(D_{\rm t}\)</span>) can also have different values
for different time periods if, for example, the hospital capacity is
expected to change over time. To ensure a consistent basis for
comparison, it is important that all decision threshold (<span class="math inline">\(D_{\rm t}\)</span>) values, the total number of
simulations (<span class="math inline">\(N\)</span>), and the time range
(<span class="math inline">\(t = t_{\rm min}…t_{\rm max}\)</span>) are
consistent across the baseline scenario and each of the policy
alternatives being compared.</p>
<div id="risk-measure-formula" class="section level4">
<h4>Risk measure formula</h4>
<div class="rmdnote">
<p><span class="math display">\[
{\small
\textrm{Expected Risk} =
  \begin{cases}
  \frac{1}{N} \sum_{n = 1}^{N}  \sum_{t = t_{\rm min}}^{t_{\rm
max}}(\max(D_t, O_{nt})-D_t) &amp;\textrm{if } D_t \textrm{ is a
maximum} \\
  \\\
  \frac{1}{N}\sum_{n = 1}^{N}  \sum_{t = t_{\rm min}}^{t_{\rm max}}(D_t
- \min(D_t, O_{nt})) &amp;\textrm{if } D_t \textrm{ is a minimum}
  \end{cases}
}
\]</span></p>
<p>Where <span class="math inline">\(n = 1…N\)</span> are the number of
simulations runs in the analysis, <span class="math inline">\(t = t_{\rm
min}…t_{\rm max}\)</span> is the simulation time over which the expected
risk is calculated, <span class="math inline">\(O_{\rm nt}\)</span> is
the model outcome result for simulation run <span class="math inline">\(n\)</span> at time <span class="math inline">\(t\)</span>, and <span class="math inline">\(D_{\rm
t}\)</span> is the decision threshold at a given time (the stated policy
objective), which can be a maximum or a minimum.</p>
<p>The Expected Risk value calculation implies the following
assumptions: (i) <strong><em>distribution neutrality of deviations from
Dt:</em></strong> a certain risk of exceeding Dt by 10 has the same
value as a risk distributed equally of an exceedance of either 0 or 20;
and (ii) <strong><em>linearity in cumulative risk:</em></strong> an
exceedance of 1 over 100 days has the same value as an exceedance of 10
over 10 days.</p>
</div>
</div>
<div id="risk-measure-formula-with-weights" class="section level4 unnumbered">
<h4 class="unnumbered">Risk measure formula with weights</h4>
<div class="rmdnote">
<p><span class="math display">\[
{\small
\textrm{Expected Risk} =
  \begin{cases}
  \frac{1}{N} \sum_{n = 1}^{N} W_n \times \sum_{t = t_{\rm min}}^{t_{\rm
max}}(\max(D_t, O_{nt})-D_t) &amp;\textrm{if } D_t \textrm{ is a
maximum} \\
  \\\
  \frac{1}{N}\sum_{n = 1}^{N} W_n \times \sum_{t = t_{\rm min}}^{t_{\rm
max}}(D_t - \min(D_t, O_{nt})) &amp;\textrm{if } D_t \textrm{ is a
minimum}
  \end{cases}
}
\]</span></p>
<p>Where <span class="math inline">\(n = 1…N\)</span> are the number of
simulations runs in the analysis, <span class="math inline">\(t = t_{\rm
min}…t_{\rm max}\)</span> is the simulation time, <span class="math inline">\(O_{\rm nt}\)</span> is the model outcome result
for simulation run <span class="math inline">\(n\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(D_{\rm
t}\)</span> is the decision threshold at a given time (the stated policy
objective), and <span class="math inline">\(W_{\rm n}\)</span> is the
weight value for simulation run <span class="math inline">\(n\)</span>.</p>
</div>
</div>
</div>
<div id="risk-calc" class="section level2">
<h2>Calculating risk with DUToolkit</h2>
<p>First, we calculate the expected risk for each policy alternative
using the <code>calculate_risk()</code> function. The policy objective
is to ensure that hospital demand remains below the available daily
hospital capacity of 750 patients, which defines the decision threshold.
We consider a baseline scenario that represented the expected outcome in
the absence of any intervention (i.e., taking no action) and a
hypothetical policy alternative (Intervention 1 – close schools). We
considered a time range of 100 days starting from 2021-01-01,
corresponding to the first day of policy implementation. We use the
model outputs for 814 simulation runs that incorporate parameter
uncertainty for the baseline scenario and Intervention 1.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># define inputs</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>tmin <span class="ot">&lt;-</span> <span class="fu">min</span>(psa_data<span class="sc">$</span>Intervention_1[, <span class="dv">1</span>]) <span class="co"># minimum simulation time</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>tmax <span class="ot">&lt;-</span> <span class="fu">max</span>(psa_data<span class="sc">$</span>Intervention_1[, <span class="dv">1</span>]) <span class="co"># maximum simulation time</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>Dt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">750</span>, <span class="fu">length</span>(tmin<span class="sc">:</span>tmax))) <span class="co"># decision threshold vector</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>Dt_max <span class="ot">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># indicates the threshold values are maximums</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># calculate risk measure</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>risk_measures_list <span class="ot">&lt;-</span> <span class="fu">calculate_risk</span>(psa_data, tmin, tmax, Dt, Dt_max)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>risk_measures_list</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; $Baseline</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; [1] 23078.21</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; $Intervention_1</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; [1] 2007.469</span></span></code></pre></div>
<p>The expected risk values for each policy alternative are challenging
to interpret independently. A more intuitive understanding can be
achieved by using a pre-defined baseline scenario as a comparator and
calculating the percent change in risk relative to the baseline
scenario. We defined this as the policy risk impact, which can be
calculated for each policy alternative using the
<code>tabulate_risk()</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="do">## generate risk table</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>risk_table <span class="ot">&lt;-</span> <span class="fu">tabulate_risk</span>(risk_measures_list,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">n_s =</span> <span class="fu">length</span>(risk_measures_list)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>risk_table</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;                    Baseline   Intervention 1</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; Risk               &quot;23078.21&quot; &quot;2007.47&quot;     </span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; Policy risk impact &quot;-&quot;        &quot;-91.30%&quot;</span></span></code></pre></div>
<div id="risk-outputs" class="section level3">
<h3>Sharing outputs</h3>
<p>In most cases, the risk table should not be presented alone but
should be accompanied by the plots described in the other vignettes to
provide additional context.</p>
<p>We also recommend the following standard description for presenting
the risk table to decision-makers. We provide the standard description
in paragraph and bullet point form for ease of use.</p>
<div id="standard-description" class="section level4 unnumbered">
<h4 class="unnumbered">Standard description</h4>
<div class="rmdnote">
<p>The expected risk values in the first row of the table above capture
the <strong>probability</strong> of the scenario
<u><em>exceeding</em></u><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> the specified policy target (i.e., how
likely it is), the <strong>magnitude</strong> of the
<u><em>exceedance</em></u><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> from the target, and the <strong>length of
time</strong> the <u><em>exceedance</em></u><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> is likely to last.
Higher risk values indicate a greater risk that the scenario will not
achieve the policy objective.</p>
<p>Interpretation of the risk value is more intuitive using a relative
comparator. The policy risk impact in the second row of the table
compares the risk associated with each intervention to the baseline
scenario. The policy risk impact is interpreted as the percent change in
risk relative to the baseline scenario. For example, the expected risk
of <u><em>exceeding</em></u><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> the policy target in Intervention 1 is
reduced by 91.30% relative to the baseline scenario.</p>
</div>
</div>
<div id="standard-description-bullet-points" class="section level4 unnumbered">
<h4 class="unnumbered">Standard description bullet points</h4>
<div class="rmdnote">
<p>The expected risk values in the first row of the table above
captures:</p>
<ul>
<li><p>The <strong>probability</strong> of the scenario
<u><em>exceeding</em></u><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> the specified policy target (i.e., how
likely it is).</p></li>
<li><p>The <strong>magnitude</strong> of the
<u><em>exceedance</em></u><a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> from the target.</p></li>
<li><p>The <strong>length of time</strong> the
<u><em>exceedance</em></u><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> is likely to last.</p></li>
<li><p>Higher risk values indicate a greater risk that the scenario will
not achieve the policy objective.</p></li>
</ul>
<p>The policy risk impact in the second row of the table:</p>
<ul>
<li><p>Compares the risk associated with each intervention to the
baseline scenario.</p></li>
<li><p>It is interpreted as the percent change in risk relative to the
baseline scenario.</p></li>
<li><p>For example, the expected risk of <u><em>exceeding</em></u><a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> the policy
target in Intervention 1 is reduced by 91.5% relative to the baseline
scenario.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>if threshold is a minimum replace with <em>falling
below</em><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>if threshold is a minimum replace with
<em>shortfall</em><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>if threshold is a minimum replace with
<em>shortfall</em><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>if threshold is a minimum replace with <em>falling
below</em><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>if threshold is a minimum replace with <em>falling
below</em><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>if threshold is a minimum replace with
<em>shortfall</em><a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>if threshold is a minimum replace with
<em>shortfall</em><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>if threshold is a minimum replace with <em>falling
below</em><a href="#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
